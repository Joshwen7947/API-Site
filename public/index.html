<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial Manager</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0f172a;
      --surface: #1e293b;
      --surface-hover: #334155;
      --border: #334155;
      --text: #f1f5f9;
      --text-muted: #94a3b8;
      --primary: #6366f1;
      --primary-hover: #818cf8;
      --danger: #ef4444;
      --danger-hover: #f87171;
      --success: #22c55e;
      --warning: #f59e0b;
      --radius: 10px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }

    /* Header */
    header {
      text-align: center;
      margin-bottom: 2.5rem;
    }
    header h1 {
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 0.25rem;
    }
    header h1 span { color: var(--primary); }
    header p { color: var(--text-muted); font-size: 0.95rem; }

    /* Status badge */
    .status-bar {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.85rem;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 500;
      background: var(--surface);
      border: 1px solid var(--border);
    }
    .badge .dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    /* Card */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .card h2 {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    /* Form */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }
    .form-grid .full { grid-column: 1 / -1; }

    label {
      display: block;
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 0.3rem;
    }
    input[type="text"], textarea {
      width: 100%;
      padding: 0.6rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg);
      color: var(--text);
      font-size: 0.9rem;
      font-family: inherit;
      outline: none;
      transition: border-color 0.15s;
    }
    input[type="text"]:focus, textarea:focus {
      border-color: var(--primary);
    }
    textarea { resize: vertical; min-height: 60px; }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding-top: 0.5rem;
    }
    .checkbox-row input[type="checkbox"] {
      accent-color: var(--primary);
      width: 16px; height: 16px;
    }
    .checkbox-row span { font-size: 0.9rem; }

    .form-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    /* Buttons */
    button {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.55rem 1.1rem;
      border: none;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 500;
      font-family: inherit;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
    }
    button:active { transform: scale(0.97); }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-primary:hover { background: var(--primary-hover); }
    .btn-danger { background: var(--danger); color: #fff; }
    .btn-danger:hover { background: var(--danger-hover); }
    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid var(--border);
    }
    .btn-ghost:hover { background: var(--surface-hover); color: var(--text); }
    .btn-sm { padding: 0.35rem 0.7rem; font-size: 0.8rem; }

    /* Search */
    .search-row {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .search-row input { flex: 1; }

    /* Table */
    .table-wrapper { overflow-x: auto; }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      text-align: left;
      padding: 0.7rem 0.75rem;
      font-size: 0.88rem;
    }
    th {
      color: var(--text-muted);
      font-weight: 500;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      border-bottom: 1px solid var(--border);
    }
    tr:not(:last-child) td { border-bottom: 1px solid var(--border); }
    tr:hover td { background: rgba(99,102,241,0.04); }

    .status-pill {
      display: inline-block;
      padding: 0.15rem 0.6rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .status-pill.published { background: rgba(34,197,94,0.15); color: var(--success); }
    .status-pill.draft { background: rgba(245,158,11,0.15); color: var(--warning); }

    .row-actions { display: flex; gap: 0.35rem; }

    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-muted);
    }
    .empty-state .icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
    .empty-state p { font-size: 0.95rem; }

    /* Toast */
    .toast-container {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .toast {
      padding: 0.65rem 1rem;
      border-radius: 8px;
      font-size: 0.85rem;
      color: #fff;
      animation: slideIn 0.25s ease;
    }
    .toast.success { background: var(--success); }
    .toast.error { background: var(--danger); }
    @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Footer */
    footer {
      text-align: center;
      margin-top: 3rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    @media (max-width: 600px) {
      .form-grid { grid-template-columns: 1fr; }
      .container { padding: 1rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><span>Tutorial</span> Manager</h1>
      <p>A simple CRUD app &mdash; powered by Express, Sequelize &amp; PostgreSQL</p>
    </header>

    <div class="status-bar">
      <span class="badge"><span class="dot"></span> API Connected</span>
      <span class="badge" id="countBadge">0 tutorials</span>
    </div>

    <!-- Create / Edit Form -->
    <div class="card" id="formCard">
      <h2 id="formTitle">Create Tutorial</h2>
      <div class="form-grid">
        <div>
          <label for="titleInput">Title</label>
          <input type="text" id="titleInput" placeholder="e.g. Getting Started with Node.js" />
        </div>
        <div class="checkbox-row">
          <input type="checkbox" id="publishedInput" />
          <span>Published</span>
        </div>
        <div class="full">
          <label for="descInput">Description</label>
          <textarea id="descInput" placeholder="A short description of the tutorial..."></textarea>
        </div>
      </div>
      <div class="form-actions">
        <button class="btn-primary" id="submitBtn" onclick="handleSubmit()">Create</button>
        <button class="btn-ghost" id="cancelBtn" onclick="cancelEdit()" style="display:none;">Cancel</button>
      </div>
    </div>

    <!-- Search + List -->
    <div class="card">
      <h2>All Tutorials</h2>
      <div class="search-row">
        <input type="text" id="searchInput" placeholder="Search by title..." oninput="loadTutorials()" />
        <button class="btn-danger btn-sm" onclick="deleteAll()">Delete All</button>
      </div>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Title</th>
              <th>Description</th>
              <th>Status</th>
              <th style="width:130px;">Actions</th>
            </tr>
          </thead>
          <tbody id="tableBody">
          </tbody>
        </table>
        <div class="empty-state" id="emptyState" style="display:none;">
          <div class="icon">ðŸ“š</div>
          <p>No tutorials yet. Create one above!</p>
        </div>
      </div>
    </div>

    <footer>
      Deployed with <strong>Coolify</strong> &bull; Express + Sequelize + PostgreSQL
    </footer>
  </div>

  <div class="toast-container" id="toasts"></div>

  <script>
    const API = '/api/tutorials';
    let editingId = null;

    // ---- Toast notifications ----
    function toast(msg, type = 'success') {
      const el = document.createElement('div');
      el.className = `toast ${type}`;
      el.textContent = msg;
      document.getElementById('toasts').appendChild(el);
      setTimeout(() => el.remove(), 3000);
    }

    // ---- Load tutorials ----
    async function loadTutorials() {
      const search = document.getElementById('searchInput').value.trim();
      const query = search ? `?title=${encodeURIComponent(search)}` : '';
      try {
        const res = await fetch(API + query);
        const data = await res.json();
        renderTable(data);
        document.getElementById('countBadge').textContent = `${data.length} tutorial${data.length !== 1 ? 's' : ''}`;
      } catch (err) {
        toast('Failed to load tutorials', 'error');
      }
    }

    function renderTable(rows) {
      const tbody = document.getElementById('tableBody');
      const empty = document.getElementById('emptyState');
      if (rows.length === 0) {
        tbody.innerHTML = '';
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';
      tbody.innerHTML = rows.map(t => `
        <tr>
          <td>${t.id}</td>
          <td><strong>${esc(t.title)}</strong></td>
          <td style="color:var(--text-muted)">${esc(t.description || 'â€”')}</td>
          <td>
            <span class="status-pill ${t.published ? 'published' : 'draft'}">
              ${t.published ? 'Published' : 'Draft'}
            </span>
          </td>
          <td>
            <div class="row-actions">
              <button class="btn-ghost btn-sm" onclick="startEdit(${t.id}, '${esc(t.title)}', '${esc(t.description || '')}', ${t.published})">Edit</button>
              <button class="btn-danger btn-sm" onclick="deleteTutorial(${t.id})">Delete</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function esc(str) {
      const d = document.createElement('div');
      d.textContent = str;
      return d.innerHTML.replace(/'/g, "\\'");
    }

    // ---- Create / Update ----
    async function handleSubmit() {
      const title = document.getElementById('titleInput').value.trim();
      const description = document.getElementById('descInput').value.trim();
      const published = document.getElementById('publishedInput').checked;

      if (!title) { toast('Title is required', 'error'); return; }

      const body = { title, description, published };

      try {
        if (editingId) {
          await fetch(`${API}/${editingId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body),
          });
          toast('Tutorial updated');
          cancelEdit();
        } else {
          await fetch(API, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body),
          });
          toast('Tutorial created');
          clearForm();
        }
        loadTutorials();
      } catch (err) {
        toast('Operation failed', 'error');
      }
    }

    function startEdit(id, title, desc, published) {
      editingId = id;
      document.getElementById('titleInput').value = title;
      document.getElementById('descInput').value = desc;
      document.getElementById('publishedInput').checked = published;
      document.getElementById('formTitle').textContent = `Edit Tutorial #${id}`;
      document.getElementById('submitBtn').textContent = 'Update';
      document.getElementById('cancelBtn').style.display = 'inline-flex';
      document.getElementById('formCard').scrollIntoView({ behavior: 'smooth' });
    }

    function cancelEdit() {
      editingId = null;
      document.getElementById('formTitle').textContent = 'Create Tutorial';
      document.getElementById('submitBtn').textContent = 'Create';
      document.getElementById('cancelBtn').style.display = 'none';
      clearForm();
    }

    function clearForm() {
      document.getElementById('titleInput').value = '';
      document.getElementById('descInput').value = '';
      document.getElementById('publishedInput').checked = false;
    }

    // ---- Delete ----
    async function deleteTutorial(id) {
      if (!confirm('Delete this tutorial?')) return;
      try {
        await fetch(`${API}/${id}`, { method: 'DELETE' });
        toast('Tutorial deleted');
        loadTutorials();
      } catch (err) {
        toast('Delete failed', 'error');
      }
    }

    async function deleteAll() {
      if (!confirm('Delete ALL tutorials? This cannot be undone.')) return;
      try {
        await fetch(API, { method: 'DELETE' });
        toast('All tutorials deleted');
        loadTutorials();
      } catch (err) {
        toast('Delete failed', 'error');
      }
    }

    // ---- Init ----
    loadTutorials();
  </script>
</body>
</html>
